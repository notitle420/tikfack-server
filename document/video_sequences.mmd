%% Sequence diagrams for video requests

%% GetVideosByDate Request
sequenceDiagram
    participant Client
    participant Handler as VideoServiceServer
    participant Usecase as VideoUsecase
    participant Repository as VideoRepository
    participant DMMAPI

    Client->>Handler: GetVideosByDateRequest(date, hits, offset)
    Handler->>Usecase: GetVideosByDate(ctx, targetDate, hits, offset)
    Usecase->>Repository: GetVideosByDate(ctx, targetDate, hits, offset)
    Repository->>DMMAPI: GET /v3/ItemList?gte_date=...&lte_date=...
    DMMAPI-->>Repository: Response(JSON)
    Repository-->>Usecase: []entity.Video, *entity.SearchMetadata
    Usecase-->>Handler: []entity.Video, *entity.SearchMetadata
    Handler-->>Client: GetVideosByDateResponse(videos, metadata)

%% Other Requests (e.g., GetVideoById)
sequenceDiagram
    participant Client
    participant Handler as VideoServiceServer
    participant Usecase as VideoUsecase
    participant Repository as VideoRepository
    participant DMMAPI

    Client->>Handler: GetVideoByIdRequest(dmm_id)
    Handler->>Usecase: GetVideoById(ctx, dmm_id)
    Usecase->>Repository: GetVideoById(ctx, dmm_id)
    Repository->>DMMAPI: GET /v3/ItemList?cid=dmm_id
    DMMAPI-->>Repository: Response(JSON)
    Repository-->>Usecase: *entity.Video
    Usecase-->>Handler: *entity.Video
    Handler-->>Client: GetVideoByIdResponse(video)

%% GetVideosByKeyword Request
sequenceDiagram
    participant Client
    participant Handler as VideoServiceServer
    participant Usecase as VideoUsecase
    participant Repository as VideoRepository
    participant DMMAPI

    Client->>Handler: GetVideosByKeywordRequest(keyword, hits, offset, sort, gte_date, lte_date, site, service, floor)
    Handler->>Usecase: GetVideosByKeyword(ctx, keyword, hits, offset, sort, gte_date, lte_date, site, service, floor)
    Usecase->>Repository: GetVideosByKeyword(ctx, keyword, hits, offset, sort, gte_date, lte_date, site, service, floor)
    Repository->>DMMAPI: GET /v3/ItemList?keyword=...&...
    DMMAPI-->>Repository: Response(JSON)
    Repository-->>Usecase: []entity.Video, *entity.SearchMetadata
    Usecase-->>Handler: []entity.Video, *entity.SearchMetadata
    Handler-->>Client: GetVideosByKeywordResponse(videos, metadata)

%% GetVideosByID Request
sequenceDiagram
    participant Client
    participant Handler as VideoServiceServer
    participant Usecase as VideoUsecase
    participant Repository as VideoRepository
    participant DMMAPI

    Client->>Handler: GetVideosByIDRequest(actress_id[], genre_id[], maker_id[], series_id[], director_id[], hits, offset, sort, gte_date, lte_date, site, service, floor)
    Handler->>Usecase: GetVideosByID(ctx, actress_id[], genre_id[], maker_id[], series_id[], director_id[], hits, offset, sort, gte_date, lte_date, site, service, floor)
    Usecase->>Repository: GetVideosByID(ctx, actress_id[], genre_id[], maker_id[], series_id[], director_id[], hits, offset, sort, gte_date, lte_date, site, service, floor)
    Repository->>DMMAPI: GET /v3/ItemList?actress_id=...&...
    DMMAPI-->>Repository: Response(JSON)
    Repository-->>Usecase: []entity.Video, *entity.SearchMetadata
    Usecase-->>Handler: []entity.Video, *entity.SearchMetadata
    Handler-->>Client: GetVideosByIDResponse(videos, metadata)

%% SearchVideos Request
sequenceDiagram
    participant Client
    participant Handler as VideoServiceServer
    participant Usecase as VideoUsecase
    participant Repository as VideoRepository
    participant DMMAPI

    Client->>Handler: SearchVideosRequest(keyword, actress_id, genre_id, maker_id, series_id, director_id)
    Handler->>Usecase: SearchVideos(ctx, keyword, actress_id, genre_id, maker_id, series_id, director_id)
    Usecase->>Repository: SearchVideos(ctx, keyword, actress_id, genre_id, maker_id, series_id, director_id)
    Repository->>DMMAPI: GET /v3/ItemList?keyword=...&...
    DMMAPI-->>Repository: Response(JSON)
    Repository-->>Usecase: []entity.Video, *entity.SearchMetadata
    Usecase-->>Handler: []entity.Video, *entity.SearchMetadata
    Handler-->>Client: SearchVideosResponse(videos, metadata)
